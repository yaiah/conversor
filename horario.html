function exportAllToPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: 'landscape',
        unit: 'mm'
    });

    const mainColor = [0, 77, 77]; // Cor principal #004d4d
    const margin = 10;
    const date = new Date().toLocaleDateString();
    let currentPage = 1;

    schedules.forEach((schedule, index) => {
        if (index > 0) {
            doc.addPage('landscape');
            currentPage++;
        }

        // Cabeçalho
        doc.setFontSize(16);
        doc.setTextColor(...mainColor);
        doc.text(schedule.name, margin, margin);
        
        doc.setFontSize(10);
        doc.setTextColor(100);
        doc.text(`Exportado em: ${date}`, doc.internal.pageSize.width - margin - 40, margin);
        doc.text(`Página ${currentPage}`, doc.internal.pageSize.width - 15, margin);

        // Preparar dados
        const headers = ['Horário', ...config.days];
        const body = schedule.scheduleData.map(period => {
            const row = [period.time]; // Coluna de horário
            
            period.classes.forEach(cls => {
                if (!cls) {
                    row.push('(Vazio)');
                } else if (cls.groups?.length > 0) {
                    // Formatação para aulas divididas
                    const groupsContent = cls.groups.map(g => 
                        `${g.name}${g.professor ? ' (Prof: ' + g.professor + ')' : ''}`
                    ).join('\n');
                    
                    row.push({
                        content: `${cls.name}\n${groupsContent}`,
                        styles: { 
                            fontSize: 8,
                            cellPadding: 2,
                            minCellHeight: cls.groups.length * 5 // Altura dinâmica
                        }
                    });
                } else {
                    // Aula normal
                    row.push({
                        content: `${cls.name}${cls.professor ? '\nProf: ' + cls.professor : ''}`,
                        styles: { fontSize: 9 }
                    });
                }
            });
            return row;
        });

        // Configuração da tabela
        doc.autoTable({
            startY: margin + 10,
            head: [headers],
            body: body,
            theme: 'grid',
            headStyles: {
                fillColor: mainColor,
                textColor: 255,
                fontSize: 10,
                cellPadding: 3,
                halign: 'center'
            },
            bodyStyles: {
                fontSize: 8,
                cellPadding: 2,
                lineColor: [200, 200, 200],
                textColor: [0, 0, 0]
            },
            columnStyles: {
                0: { 
                    cellWidth: 18, // Coluna de horários
                    fontStyle: 'bold',
                    halign: 'center'
                },
                ...Object.fromEntries(
                    Array.from({ length: config.days.length }, (_, i) => [
                        i + 1, { 
                            cellWidth: 25,
                            minCellHeight: 8
                        }
                    ])
                )
            },
            margin: { top: margin + 10 },
            didDrawPage: function(data) {
                // Rodapé com número de página
                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text(
                    `Página ${data.pageCount}`,
                    doc.internal.pageSize.width - 15,
                    doc.internal.pageSize.height - 5
                );
            }
        });
    });

    // Salvar o arquivo
    const fileName = `Agendas_Completas_${new Date().toISOString().split('T')[0]}.pdf`;
    doc.save(fileName);
}
